<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß Firebase Auth Test | StudyGenie AI</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
    body { background: #f5f5f5; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; border: 1px solid #ddd; }
    .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .pending { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:hover { background: #0056b3; }
    input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Firebase Auth Debug Tool</h1>
    <p>Use this page to test and fix authentication issues. Run tests in order.</p>

    <!-- Firebase Connection Test -->
    <div class="test-section">
      <h3>1. Test Firebase Connection</h3>
      <button onclick="testFirebaseConnection()">Test Firebase Connection</button>
      <div id="firebase-status" class="status pending">‚è≥ Click to test Firebase connection</div>
    </div>

    <!-- Signup Test -->
    <div class="test-section">
      <h3>2. Test Signup</h3>
      <input type="email" id="signup-email" placeholder="Email" value="test@example.com">
      <input type="password" id="signup-password" placeholder="Password" value="test123">
      <input type="text" id="signup-university" placeholder="University" value="Test University">
      <input type="tel" id="signup-phone" placeholder="Phone" value="1234567890">
      <br><button onclick="testSignup()">Test Signup</button>
      <div id="signup-status" class="status pending">‚è≥ Click to test signup</div>
    </div>

    <!-- Login Test -->
    <div class="test-section">
      <h3>3. Test Login</h3>
      <input type="email" id="login-email" placeholder="Email" value="test@example.com">
      <input type="password" id="login-password" placeholder="Password" value="test123">
      <br><button onclick="testLogin()">Test Login</button>
      <div id="login-status" class="status pending">‚è≥ Click to test login</div>
    </div>

    <!-- Firestore Test -->
    <div class="test-section">
      <h3>4. Test Firestore Access</h3>
      <button onclick="testFirestoreAccess()">Test Firestore Access</button>
      <div id="firestore-status" class="status pending">‚è≥ Click to test Firestore access</div>
    </div>
  </div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCu0sHyEGFchcaCyi8Q2eUYsO-_0dhBxys",
      authDomain: "studygenei-cd135.firebaseapp.com",
      projectId: "studygenei-cd135",
      appId: "1:20859073320:web:889b272d57f684066bd61d"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Test functions
    window.testFirebaseConnection = async function() {
      const status = document.getElementById('firebase-status');
      try {
        status.textContent = '‚è≥ Testing Firebase connection...';
        status.className = 'status pending';

        // Simple test - check if auth is initialized
        if (auth && db) {
          status.textContent = '‚úÖ Firebase connection successful!';
          status.className = 'status success';
        } else {
          throw new Error('Firebase not initialized');
        }
      } catch (error) {
        status.textContent = '‚ùå Firebase connection failed: ' + error.message;
        status.className = 'status error';
        console.error('Firebase connection error:', error);
      }
    };

    window.testSignup = async function() {
      const status = document.getElementById('signup-status');
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const university = document.getElementById('signup-university').value;
      const phone = document.getElementById('signup-phone').value;

      try {
        status.textContent = '‚è≥ Creating account...';
        status.className = 'status pending';

        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Save to Firestore
        await setDoc(doc(db, "users", user.uid), {
          email,
          university,
          phone,
          provider: "password",
          createdAt: new Date()
        });

        status.textContent = '‚úÖ Account created and saved to Firestore!';
        status.className = 'status success';
      } catch (error) {
        status.textContent = '‚ùå Signup failed: ' + error.message;
        status.className = 'status error';
        console.error('Signup error:', error);
      }
    };

    window.testLogin = async function() {
      const status = document.getElementById('login-status');
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      try {
        status.textContent = '‚è≥ Logging in...';
        status.className = 'status pending';

        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        status.textContent = '‚úÖ Login successful! User: ' + user.email;
        status.className = 'status success';
      } catch (error) {
        status.textContent = '‚ùå Login failed: ' + error.message;
        status.className = 'status error';
        console.error('Login error:', error);
      }
    };

    window.testFirestoreAccess = async function() {
      const status = document.getElementById('firestore-status');

      try {
        status.textContent = '‚è≥ Testing Firestore access...';
        status.className = 'status pending';

        // Try to read current user's document
        const user = auth.currentUser;
        if (!user) {
          throw new Error('No user logged in');
        }

        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()) {
          const data = userDoc.data();
          status.textContent = '‚úÖ Firestore access successful! User data: ' + JSON.stringify(data);
          status.className = 'status success';
        } else {
          throw new Error('User document not found');
        }
      } catch (error) {
        status.textContent = '‚ùå Firestore access failed: ' + error.message;
        status.className = 'status error';
        console.error('Firestore error:', error);
      }
    };
  </script>
</body>
</html>
